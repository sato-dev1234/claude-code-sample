---
name: code-comment-review
description: "Reviews code comments for quality issues including LLM generation traces, implementation history leakage, and missing API documentation. Use when verifying comment quality after code changes."
user-invocable: true
allowed-tools: Read, Write, Bash, Task, Glob, Grep, AskUserQuestion
---

# /code-comment-review

1. Select target ticket via managing-tickets → `TICKET_PATH`

2. Determine scope via AskUserQuestion: uncommitted (`git diff HEAD`) or branch (`git diff <BASE>...HEAD`)

3. Launch Explore agent to gather git info → `GATHERED_INFO`
   - "Get git diff (use scope from Step 2). Read all changed files. Return diff and file contents."

4. Resolve CONFIG: `python ~/.claude/scripts/resolve_config.py "$CWD" code-comment-review`

5. Execute review workflow (see below)

6. Write report to `<TICKET_PATH>/comment-review-report.md`

   Format (numbered list, sorted by score descending):
   ```markdown
   # Comment Review Report

   Found X issues:

   1. [Score: 95] Description
      file:line

   2. [Score: 75] Description
      file:line

   3. [Score: 60] Description
      file:line
   ```

   If no issues found (X = 0):
   ```markdown
   # Comment Review Report

   問題なし - コメント品質に関する問題は検出されませんでした。
   ```

7. Report summary in Japanese
   - All findings sorted by score (high to low)

8. Mark `/code-comment-review` as completed in <TICKET_PATH>/tasks.md Workflow section

---

## Review criteria

Principle: Comments should serve their intended purpose - providing context and intent, not restating code or revealing generation artifacts.

**LLM generation traces**
- AI/LLM/Claude mentions in comments or code
- "Generated by", "Created by" markers
- Must be removed for production readiness

**Implementation history in comments**
- "Added for X", "To fix Y" (belongs in commit message, not code)
- 「〇〇のために追加」「△△に対応」
- Historical context should be in version control, not comments

**Conversational tone**
- "Here we", "This allows", "Let's", "Now we"
- 「ここでは」「これにより」「次に」
- Comments should be declarative, not conversational

**HOW vs WHY violation**
- Comments explaining implementation details (HOW): technology names, algorithm steps, data structure details
- Comments must explain intent (WHY): business purpose, domain terms, constraints
- Example: "Uses SHA-256 to hash passwords" (HOW) → "Passwords must be hashed for security compliance" (WHY)

**Redundant comments**
- Comments that duplicate what code already expresses clearly
- Example: `// Set name to user name` above `this.name = user.name`
- Self-documenting code is preferred

**Missing documentation**
- Public API without Purpose, Parameters, Return documentation
- Complex domain logic without WHY explanation

---

## Review workflow

Copy this checklist and track your progress:

```
Progress:
- [ ] Step 1: Load project knowledge
- [ ] Step 2: Check criteria and detect violations
- [ ] Step 3: Score each finding (0-100)
- [ ] Step 4: Generate report
```

**Step 1: Load project knowledge**

Run: `python ~/.claude/scripts/resolve_knowledge.py --refs "${TICKET_PATH}/knowledge-refs.md" --workflow "/code-comment-review" --base "${CONFIG.BASE_PATH}"`

- On success/partial: use `knowledge[].content` for Terminology section and project-specific comment conventions
- On failure: continue without knowledge (use general best practices)

**Step 2: Check criteria and detect violations**

Check each criterion in Review criteria section against GATHERED_INFO and detect violations.

**Step 3: Score each finding (0-100)**

For each finding, assign confidence score based on evidence strength:
- **100**: Absolutely certain, definitely real
- **75**: Highly confident, real and important
- **50**: Moderately confident, real but minor
- **25**: Somewhat confident, might be real
- **0**: Not confident, false positive

**Step 4: Generate report**

Output format:
```markdown
## Comments Review

Found X issues:

1. [Score: 95] Description

   file:line

2. [Score: 82] Description

   file:line
```
